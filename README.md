# IOS2
 
# IOS – projekt 2 (synchronizace)
Zadání je inspirováno knihou Allen B. Downey: The Little Book of SemaphoresPopis Úlohy (Santa Claus problem)

Santa Claus spí ve své dílně na severním pólu a může být vzbuzen pouze 
1. ve chvíli, kdy jsou všichni jeho sobi zpět z letní dovolené, nebo
2. někteří z jeho skřítků mají problém s výrobou hraček a potřebují pomoci. Aby se Santa Claus prospal, skřítci čekají potichu před dílnou. Ve chvíli, kdy čekají alespoň 3, tak první 3 z fronty najednou vstoupí do dílny. Ostatní skřítci, co potřebují pomoci musí čekat před dílnou až bude volno. Ve chvíli, kdy přijde poslední sob z dovolené je pomoc čekajícím skřítkům možné odložit. Santa dává na dveře dílny nápis „Vánoce – zavřeno“ a jde zapřahat soby do saní. Všichni skřítci, co čekají před dílnou ihned odcházejí na dovolenou. Ostatní skřítci odchází na dovolenou ve chvíli, kdy potřebují pomoc od Santy a zjistí, že je dílna zavřená. Podrobná specifikace úlohy
3. Spuštění:$ ./proj2 NE NR TE TR
•NE: počet skřítků. 0<NE<1000
•NR: počet sobů. 0<NR< 20
•TE: Maximální doba v milisekundách, po kterou skřítek pracuje samostatně. 0<=TE<=1000.
•TR: Maximální doba v milisekundách, po které se sob vrací z dovolené domů. 0<=RE<=1000.
Všechny parametry jsou nezáporná celá čísla. Chybové stavy:
•Pokud některý ze vstupů nebude odpovídat očekávanému formátu nebo bude mimo povolený rozsah, program vytiskne chybové hlášení na standardní chybový výstup, uvolní všechny dosud alokované zdroje a ukončí se s kódem (exit code) 1.
•Pokud selže některá z operací se semafory, nebo sdílenou pamětí, postupujte stejně-- program vytiskne chybové hlášení na standardní chybový výstup, uvolní všechny dosud alokované zdroje a ukončí se s kódem (exit code) 1.
Implementační detaily:•Každý proces vykonává své akce a současně zapisuje informace o akcích do souboru s názvem proj2.out. Součástí výstupních informací o akci je pořadové číslo A prováděné akce (viz popis výstupů). Akce se číslují od jedničky.•Použijte sdílenou paměť pro implementaci čítače akcí a sdílených proměnných nutných pro synchronizaci.•Použijte semafory pro synchronizaci procesů.•Nepoužívejte aktivní čekání (včetně cyklického časového uspání procesu) pro účely synchronizace.•Pracujte s procesy, ne s vlákny.Hlavní proces1.Hlavní proces vytváří ihned po spuštění jeden proces Santa, NE procesů skřítků a NR procesů sobů. 2.Poté čeká na ukončení všech procesů, které aplikace vytváří. Jakmile jsou tyto procesy ukončeny, ukončí se i hlavní proces s kódem (exit code) 0.Proces Santa1.Po spuštění vypíše:  A: Santa: going to sleep2.Po probuzení skřítky jde pomáhat elfům---vypíše: A: Santa: helping elves3.Poté, co pomůže skřítkům jde spát (bez ohledu na to, jestli před dílnou čekají další skřítci) avypíše: A: Santa: going to sleep4.Po probuzení posledním sobem uzavře dílnu a vypíše: A: Santa: closing workshopa pak jde ihned zapřahat soby do saní.5.Ve chvíli, kdy jsou zapřažení všichni soby vypíše: A: Santa: Christmas starteda ihned proces končí.Proces Skřítek1.Každý skřítek je unikátně identifikován číslem elfID. 0<elfID<=NE2.Po spuštění vypíše: A: Elf elfID: started3.Samostatnou práci modelujte voláním funkce usleep na náhodný čas v intervalu <0,TE>.4.Když skončí samostatnou práci, potřebuje pomoc od Santy. Vypíše: A: Elf elfID: need helpa zařadí se do fronty před Santovou dílnou.5.Pokud je třetí ve frontě před dílnou, dílna je prázdná a na dílně není cedule „Vánoce – zavřeno“,tak společně s prvním a druhým z fronty vstoupí do dílny a vzbudí Santu.6.Skřítek v dílně dostane pomoc a vypíše: A: Elf elfID: get help  (na pořadí pomoci skřítkům v dílně nezáleží)7.Po obdržení pomoci ihned odchází z dílny a pokud je dílna již volná, tak při odchodu z dílny může upozornit čekající skřítky, že už je volno (volitelné).8.Pokud je na dveřích dílny nápis „Vánoce – zavřeno“ vypíše: A: Elf elfID: taking holidaysa proces ihned skončí.Proces Sob1.Každý sob je identifikován číslem rdID, 0<rdID<=NR
2.Po spuštění vypíše: A: RD rdID: rstarted3.Čas na dovolené modelujte voláním usleep na náhodný interval <TR/2,TR>4.Po návratu z letní dovolené vypíše: A: RD rdID: return homea následně čeká, než ho Santa zapřáhne k saním. Pokud je posledním sobem, který se vrátil z dovolené, tak vzbudí Santu.5.Po zapřažení do saní vypíše: A: RD rdID: get hitcheda následně proces končí.Podmínky vypracováníObecné informace•Projekt implementujte v jazyce C. Komentujte zdrojové kódy, programujte přehledně. Součástíhodnocení bude i kvalita zdrojového kódu.•Kontrolujte, zda se všechny procesy ukončují korektně a zda při ukončování správně uvolňujetevšechny alokované zdroje.•Dodržujte syntax zadaných jmen, formát souborů a formát výstupních dat. Použijte základnískript pro ověření korektnosti výstupního formátu (dostupný z webu se zadáním). •Dotazy k zadání: Veškeré nejasnosti a dotazy řešte pouze prostřednictvím diskuzního fóra kprojektu 2.•Poznámka k testování: Můžete si nasimulovat častější přepínání procesů například vložením krátkého uspání po uvolnění semaforů apod. Pouze pro testovací účely, do finálního řešení nevkládejte!Překlad•Pro překlad používejte nástroj make. Součástí odevzdání bude soubor Makefile.•Překlad se provede příkazem make v adresáři, kde je umístěn soubor Makefile.•Po překladu vznikne spustitelný soubor se jménem proj2, který bude umístěn ve stejném adresáři jako soubor Makefile•Zdrojové kódy překládejte s přepínači -std=gnu99 -Wall -Wextra -Werror -pedantic•Pokud to vaše řešení vyžaduje, lze přidat další přepínače pro linker (např. kvůli semaforům čisdílené paměti, -pthread, -lrt , . . . ).•Vaše řešení musí být možné přeložit a spustit na serveru merlin.Odevzdání•Součástí odevzdání budou pouze soubory se zdrojovými kódy (*. , *.h ) a soubor Makefile.Tyto soubory zabalte pomocí nástroje zip do archivu s názvem proj2.zip.•Archiv vytvořte tak, aby po rozbalení byl soubor Makefile umístěn ve stejném adresáři, jako jearchiv.•Archiv proj2.zip odevzdejte prostřednictvím informačního systému—termín Projekt 2.•Pokud nebude dodržena forma odevzdání nebo projekt nepůjde přeložit, bude projekt hodnocen0 body.•Archiv odevzdejte pomocí informačního systému v dostatečném předstihu (odevzdaný soubormůžete před vypršením termínu snadno nahradit jeho novější verzí, kdykoliv budete potřebovat).
Příklad výstupuPříklad výstupního souboru proj2.out pro následující příkaz:$ ./proj2 5 4 100 100-----------------------------1: Elf 1: started2: Elf 2: started3: Elf 1: need help4: Santa: going to sleep5: RD 1: rstarted6: Elf 2: need help7: Elf 3: started8: RD 4: rstarted9: Elf 4: started10: Elf 5: started11: RD 3: rstarted12: RD 3: return home13: Elf 5: need help14: RD 2: rstarted15: Santa: helping elves16: Elf 2: get help17: Elf 5: get help18: RD 1: return home19: Elf 1: get help20: Santa: going to sleep21: Elf 4: need help22: Elf 5: need help23: Elf 1: need help24: Elf 2: need help25: Santa: helping elves26: Elf 1: get help27: Elf 4: get help28: Elf 5: get help29: Santa: going to sleep30: RD 2: return home31: RD 4: return home32: Santa: closing workshop33: RD 1: get hitched34: Elf 2: taking holidays35: RD 3: get hitched36: Elf 1: need help37: Elf 1: taking holidays38: RD 2: get hitched39: RD 4: get hitched40: Santa: Christmas started41: Elf 4: need help42: Elf 5: need help43: Elf 5: taking holidays44: Elf 3: need help45: Elf 4: taking holidays46: Elf 3: taking holidays
